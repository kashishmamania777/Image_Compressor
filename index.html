<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced File Compressor</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            width: 100%;
            max-width: 1400px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f5f7ff 0%, #e8f0ff 100%);
            margin-bottom: 30px;
        }
        
        .upload-area:hover {
            border-color: #764ba2;
            background: linear-gradient(135deg, #e8f0ff 0%, #f0f8ff 100%);
            transform: translateY(-2px);
        }
        
        .upload-area.dragover {
            background: linear-gradient(135deg, #e0f0ff 0%, #d0e8ff 100%);
            border-color: #007bff;
            transform: scale(1.02);
        }
        
        .upload-area.error {
            border-color: #dc3545;
            color: #dc3545;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
        }
        
        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
            display: block;
        }
        
        .file-info {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            border-radius: 15px;
            border: 1px solid #e0e8ff;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 80px;
            position: relative;
        }
        
        .preset-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        
        .preset-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .quality-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .quality-excellent { background: #28a745; }
        .quality-good { background: #17a2b8; }
        .quality-fair { background: #ffc107; color: #333; }
        .quality-poor { background: #dc3545; }
        
        .quality-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quality-control input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .quality-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }
        
        .size-limit-control select {
            padding: 10px 15px;
            border: 2px solid #e0e8ff;
            border-radius: 10px;
            background: white;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        .size-limit-control select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .preview-container {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
        }
        
        .preview {
            border: 1px solid #e0e8ff;
            border-radius: 15px;
            overflow: hidden;
            background: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .preview:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        
        .comparison-container {
            position: relative;
            height: 300px;
            overflow: hidden;
            border-radius: 15px 15px 0 0;
            background: #f8f9fa;
            cursor: pointer;
        }
        
        .comparison-container.clickable {
            cursor: pointer;
        }
        
        .comparison-container.clickable:hover::after {
            content: "üîç Click for detailed comparison view";
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 25;
            animation: fadeInUp 0.3s ease;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateX(-50%) translateY(10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        .image-comparison-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .comparison-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        
        .comparison-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-image.original {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            z-index: 1;
        }
        
        .comparison-image.compressed {
            background: linear-gradient(135deg, #f0fff4 0%, #e8f5e8 100%);
            z-index: 2;
            clip-path: inset(0 50% 0 0);
            transition: clip-path 0.15s ease;
        }
        
        .comparison-image.compressed.disabled {
            z-index: 0;
            opacity: 0.3;
        }
        
        .comparison-labels {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            z-index: 15;
            pointer-events: none;
        }
        
        .comparison-label {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            backdrop-filter: blur(5px);
        }
        
        .comparison-label.original {
            background: rgba(220, 53, 69, 0.9);
        }
        
        .comparison-label.compressed {
            background: rgba(40, 167, 69, 0.9);
        }
        
        .comparison-slider-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 60px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .comparison-container:hover .comparison-slider-overlay {
            opacity: 1;
        }
        
        .comparison-slider-overlay.active {
            opacity: 1;
        }
        
        .comparison-slider-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            pointer-events: auto;
            min-width: 300px;
        }
        
        .slider-label {
            text-align: center;
            margin-bottom: 10px;
            font-size: 12px;
            font-weight: 600;
            color: #333;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .comparison-slider {
            width: 100%;
            height: 6px;
            background: linear-gradient(to right, #dc3545 0%, #28a745 100%);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
            position: relative;
        }
        
        .comparison-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 3px solid #667eea;
            transition: all 0.2s ease;
        }
        
        .comparison-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .comparison-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 3px solid #667eea;
            transition: all 0.2s ease;
        }
        
        .slider-values {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 10px;
            color: #666;
        }
        
        .divider-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, transparent 0%, white 20%, white 80%, transparent 100%);
            z-index: 12;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            transition: left 0.15s ease;
            opacity: 0;
        }
        
        .comparison-container:hover .divider-line {
            opacity: 1;
        }
        
        .comparison-slider-overlay.active ~ .divider-line {
            opacity: 1;
        }
        
        .quality-score {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 600;
            z-index: 15;
            backdrop-filter: blur(5px);
        }
        
        .quality-excellent-score { background: rgba(40, 167, 69, 0.9); }
        .quality-good-score { background: rgba(23, 162, 184, 0.9); }
        .quality-fair-score { background: rgba(255, 193, 7, 0.9); color: #333; }
        .quality-poor-score { background: rgba(220, 53, 69, 0.9); }
        
        .placeholder-text {
            color: #6c757d;
            font-size: 14px;
            text-align: center;
            font-style: italic;
            padding: 20px;
        }
        
        .preview-info {
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
        }
        
        .file-details {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .file-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .file-type {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .quality-assessment {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
            border: 1px solid #e0e8ff;
        }
        
        .quality-metric {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
        }
        
        .quality-metric .metric-label {
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .quality-metric .metric-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .quality-metric.visual-quality {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .quality-metric.compression-ratio {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }
        
        .quality-metric.file-size {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .quality-metric.efficiency {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.2);
        }
        
        .size-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .size-info {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .size-info.original {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.2);
        }
        
        .size-info.compressed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }
        
        .compression-status {
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
            padding: 8px;
            border-radius: 8px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .compression-status.ready {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }
        
        .compression-status.compressing {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }
        
        .compression-status.completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }
        
        .compression-status.error {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .download-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-10px);
        }
        
        .download-btn.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .compression-progress {
            width: 100%;
            height: 6px;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .compression-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #007bff, #0056b3);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }
        
        .error-message {
            color: #dc3545;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid rgba(220, 53, 69, 0.2);
            font-size: 14px;
        }
        
        .savings-badge {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 600;
            z-index: 15;
            backdrop-filter: blur(5px);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: relative;
            margin: 2% auto;
            width: 95%;
            max-width: 1200px;
            height: 90%;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .modal-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .modal-comparison {
            flex: 1;
            position: relative;
            border: 2px solid #e0e8ff;
            border-radius: 15px;
            overflow: hidden;
            background: #f8f9fa;
            margin-bottom: 20px;
        }
        
        .modal-image-comparison-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .modal-comparison-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-comparison-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }
        
        .modal-comparison-image.original {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            z-index: 1;
        }
        
        .modal-comparison-image.compressed {
            background: linear-gradient(135deg, #f0fff4 0%, #e8f5e8 100%);
            z-index: 2;
            clip-path: inset(0 50% 0 0);
            transition: clip-path 0.15s ease;
        }
        
        .modal-comparison-labels {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            pointer-events: none;
        }
        
        .modal-comparison-label {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .modal-comparison-label.original {
            background: rgba(220, 53, 69, 0.9);
        }
        
        .modal-comparison-label.compressed {
            background: rgba(40, 167, 69, 0.9);
        }
        
        .modal-divider-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 3px;
            background: white;
            z-index: 10;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            transition: left 0.15s ease;
        }
        
        .modal-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            border-radius: 15px;
        }
        
        .modal-slider-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .modal-slider-container label {
            font-weight: 600;
            color: #333;
            white-space: nowrap;
        }
        
        .modal-slider {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #dc3545 0%, #28a745 100%);
            outline: none;
            -webkit-appearance: none;
        }
        
        .modal-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
            border: 3px solid #667eea;
        }
        
        .zoom-controls {
            display: flex;
            gap: 10px;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .zoom-btn:hover {
            background: #764ba2;
            transform: scale(1.1);
        }
        
        .reset-btn {
            background: #6c757d;
        }
        
        .reset-btn:hover {
            background: #5a6268;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .preview-container {
                grid-template-columns: 1fr;
            }
            
            .quality-assessment {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 98%;
                height: 95%;
                margin: 1% auto;
            }
            
            .modal-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .modal-slider-container {
                width: 100%;
            }
            
            .comparison-slider-container {
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Advanced File Compressor - Fixed Comparison</h1>
        
        <div class="upload-area" id="upload-area">
            <span class="upload-icon">üìÅ</span>
            <div><strong>Drag & Drop files here or click to select</strong></div>
            <div class="file-info">
                <strong>Supported formats:</strong> JPEG, PNG, WebP, GIF, BMP<br>
                <strong>Maximum file size:</strong> <span id="max-size-display">5 MB</span> per file
            </div>
            <input type="file" id="fileElem" multiple accept="image/jpeg,image/jpg,image/png,image/webp,image/gif,image/bmp" style="display:none">
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label>üìè Max Size per File</label>
                <div class="size-limit-control">
                    <select id="size-limit">
                        <option value="1">1 MB</option>
                        <option value="2">2 MB</option>
                        <option value="5" selected>5 MB</option>
                        <option value="10">10 MB</option>
                        <option value="20">20 MB</option>
                    </select>
                </div>
            </div>
            
            <div class="control-group">
                <label>‚ö° Compression Presets</label>
                <div class="preset-buttons">
                    <button class="preset-btn" data-quality="95">
                        High Quality
                        <span class="quality-indicator quality-excellent">‚òÖ</span>
                    </button>
                    <button class="preset-btn active" data-quality="80">
                        Balanced
                        <span class="quality-indicator quality-good">‚òÖ</span>
                    </button>
                    <button class="preset-btn" data-quality="60">
                        Small Size
                        <span class="quality-indicator quality-fair">‚òÖ</span>
                    </button>
                    <button class="preset-btn" data-quality="40">
                        Tiny
                        <span class="quality-indicator quality-poor">‚òÖ</span>
                    </button>
                </div>
            </div>
            
            <div class="control-group">
                <label>üéõÔ∏è Custom Quality: <span id="quality-value">80%</span></label>
                <div class="quality-control">
                    <input type="range" id="quality" min="10" max="100" value="80">
                </div>
            </div>
            
            <div class="control-group">
                <button class="btn btn-primary" id="compress-all">üöÄ Compress All Files</button>
                <button class="btn btn-success" id="download-all">üì• Download All Compressed</button>
            </div>
        </div>
        
        <div id="error-container"></div>
        <div class="preview-container" id="preview-container"></div>
    </div>

    <!-- Modal for detailed comparison -->
    <div id="comparison-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üîç Detailed Image Comparison</div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-comparison">
                    <div class="modal-image-comparison-wrapper">
                        <div class="modal-comparison-image original">
                            <img id="modal-original-img" src="" alt="Original">
                        </div>
                        <div class="modal-comparison-image compressed">
                            <img id="modal-compressed-img" src="" alt="Compressed">
                        </div>
                        <div class="modal-comparison-labels">
                            <div class="modal-comparison-label original">Original</div>
                            <div class="modal-comparison-label compressed">Compressed</div>
                        </div>
                        <div class="modal-divider-line"></div>
                    </div>
                </div>
                <div class="modal-controls">
                    <div class="modal-slider-container">
                        <label>üîÑ Comparison Slider:</label>
                        <input type="range" id="modal-comparison-slider" class="modal-slider" min="0" max="100" value="50">
                        <span id="modal-slider-value">50%</span>
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomModalImage('in')">+</button>
                        <button class="zoom-btn" onclick="zoomModalImage('out')">-</button>
                        <button class="zoom-btn reset-btn" onclick="resetModalZoom()">‚ü≤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('upload-area');
        const fileElem = document.getElementById('fileElem');
        const previewContainer = document.getElementById('preview-container');
        const qualitySlider = document.getElementById('quality');
        const qualityValue = document.getElementById('quality-value');
        const sizeLimitSelect = document.getElementById('size-limit');
        const maxSizeDisplay = document.getElementById('max-size-display');
        const compressAllBtn = document.getElementById('compress-all');
        const downloadAllBtn = document.getElementById('download-all');
        const errorContainer = document.getElementById('error-container');
        const presetButtons = document.querySelectorAll('.preset-btn');
        const modal = document.getElementById('comparison-modal');
        const modalOriginalImg = document.getElementById('modal-original-img');
        const modalCompressedImg = document.getElementById('modal-compressed-img');
        const modalComparisonSlider = document.getElementById('modal-comparison-slider');
        const modalSliderValue = document.getElementById('modal-slider-value');

        let uploadedFiles = [];
        let compressedFiles = [];
        let currentModalZoom = 1;

        // Quality assessment functions
        function calculateVisualQuality(originalSize, compressedSize, quality) {
            const compressionRatio = compressedSize / originalSize;
            const qualityFactor = quality / 100;
            const score = (qualityFactor * 0.7) + ((1 - compressionRatio) * 0.3);
            return Math.round(score * 100);
        }

        function getQualityGrade(score) {
            if (score >= 85) return { grade: 'A+', class: 'excellent', description: 'Excellent' };
            if (score >= 75) return { grade: 'A', class: 'good', description: 'Very Good' };
            if (score >= 65) return { grade: 'B', class: 'fair', description: 'Good' };
            if (score >= 50) return { grade: 'C', class: 'fair', description: 'Fair' };
            return { grade: 'D', class: 'poor', description: 'Poor' };
        }

        function calculateCompressionRatio(originalSize, compressedSize) {
            return Math.round(((originalSize - compressedSize) / originalSize) * 100);
        }

        function calculateEfficiencyScore(compressionRatio, visualQuality) {
            return Math.round((compressionRatio + visualQuality) / 2);
        }

        // Modal functions
        function openModal(originalSrc, compressedSrc, fileName) {
            modalOriginalImg.src = originalSrc;
            modalCompressedImg.src = compressedSrc;
            modal.style.display = 'block';
            document.querySelector('.modal-title').textContent = `üîç Detailed Comparison - ${fileName}`;
            resetModalZoom();
            
            // Reset modal slider
            modalComparisonSlider.value = 50;
            modalSliderValue.textContent = '50%';
            updateModalComparison();
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function zoomModalImage(direction) {
            if (direction === 'in') {
                currentModalZoom = Math.min(currentModalZoom * 1.2, 5);
            } else {
                currentModalZoom = Math.max(currentModalZoom / 1.2, 0.2);
            }
            
            modalOriginalImg.style.transform = `scale(${currentModalZoom})`;
            modalCompressedImg.style.transform = `scale(${currentModalZoom})`;
        }

        function resetModalZoom() {
            currentModalZoom = 1;
            modalOriginalImg.style.transform = 'scale(1)';
            modalCompressedImg.style.transform = 'scale(1)';
        }

        function updateModalComparison() {
            const value = modalComparisonSlider.value;
            modalSliderValue.textContent = value + '%';
            
            const compressedImage = document.querySelector('.modal-comparison-image.compressed');
            const dividerLine = document.querySelector('.modal-divider-line');
            
            if (compressedImage && dividerLine) {
                const clipValue = 100 - value;
                compressedImage.style.clipPath = `inset(0 ${clipValue}% 0 0)`;
                dividerLine.style.left = value + '%';
            }
        }

        // Modal slider functionality
        modalComparisonSlider.addEventListener('input', updateModalComparison);

        // Close modal when clicking outside or pressing Escape
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.style.display === 'block') {
                closeModal();
            }
        });

        // Compression presets
        const presets = {
            95: { name: 'High Quality', description: 'Best quality, larger files' },
            80: { name: 'Balanced', description: 'Good balance of quality and size' },
            60: { name: 'Small Size', description: 'Smaller files, good quality' },
            40: { name: 'Tiny', description: 'Smallest files, basic quality' }
        };

        // Supported file types
        const supportedTypes = {
            'image/jpeg': { name: 'JPEG', icon: 'üñºÔ∏è' },
            'image/jpg': { name: 'JPEG', icon: 'üñºÔ∏è' },
            'image/png': { name: 'PNG', icon: 'üñºÔ∏è' },
            'image/webp': { name: 'WebP', icon: 'üñºÔ∏è' },
            'image/gif': { name: 'GIF', icon: 'üéûÔ∏è' },
            'image/bmp': { name: 'BMP', icon: 'üñºÔ∏è' }
        };

        // Preset button handlers
        presetButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                presetButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const quality = parseInt(btn.dataset.quality);
                qualitySlider.value = quality;
                qualityValue.textContent = quality + '%';
            });
        });

        // Update quality display
        qualitySlider.addEventListener('input', () => {
            const value = qualitySlider.value;
            qualityValue.textContent = value + '%';
            
            presetButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.quality == value);
            });
        });

        // Update max size display
        sizeLimitSelect.addEventListener('change', () => {
            maxSizeDisplay.textContent = sizeLimitSelect.value + ' MB';
        });

        uploadArea.addEventListener('click', () => fileElem.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        fileElem.addEventListener('change', () => {
            handleFiles(fileElem.files);
        });

        function handleFiles(files) {
            errorContainer.innerHTML = '';
            uploadArea.classList.remove('error');
            
            const maxSizeMB = parseInt(sizeLimitSelect.value);
            const maxSizeBytes = maxSizeMB * 1024 * 1024;
            let hasErrors = false;
            let errorMessages = [];

            for (const file of files) {
                if (!supportedTypes[file.type]) {
                    errorMessages.push(`${file.name}: Unsupported file type. Only JPEG, PNG, WebP, GIF, and BMP are supported.`);
                    hasErrors = true;
                    continue;
                }

                if (file.size > maxSizeBytes) {
                    errorMessages.push(`${file.name}: File size (${formatFileSize(file.size)}) exceeds the maximum limit of ${maxSizeMB} MB.`);
                    hasErrors = true;
                    continue;
                }

                uploadedFiles.push(file);
                displayPreview(file);
            }

            if (hasErrors) {
                uploadArea.classList.add('error');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.innerHTML = '<strong>‚ö†Ô∏è Upload Errors:</strong><br>' + errorMessages.join('<br>');
                errorContainer.appendChild(errorDiv);
            }
        }

        function displayPreview(file) {
            const fileType = supportedTypes[file.type];
            const reader = new FileReader();
            
            reader.onload = (e) => {
                const preview = document.createElement('div');
                preview.classList.add('preview');
                
                const previewId = 'preview-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                
                preview.innerHTML = `
                    <div class="comparison-container" data-preview-id="${previewId}">
                        <div class="image-comparison-wrapper">
                            <div class="comparison-image original">
                                <img src="${e.target.result}" alt="${file.name}" data-original-src="${e.target.result}">
                            </div>
                            <div class="comparison-image compressed disabled">
                                <div class="placeholder-text">Compression pending...</div>
                            </div>
                            <div class="comparison-labels">
                                <div class="comparison-label original">Original</div>
                                <div class="comparison-label compressed">Compressed</div>
                            </div>
                            <div class="divider-line"></div>
                        </div>
                        <div class="comparison-slider-overlay">
                            <div class="comparison-slider-container">
                                <div class="slider-label">üîÑ Drag to Compare</div>
                                <input type="range" class="comparison-slider" min="0" max="100" value="50" 
                                       onchange="updateFullImageComparison(this)" 
                                       oninput="updateFullImageComparison(this)"
                                       onclick="event.stopPropagation()"
                                       disabled>
                                <div class="slider-values">
                                    <span>Original</span>
                                    <span>Compressed</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="preview-info">
                        <div class="file-details">
                            <span class="file-name">${file.name}</span>
                            <span class="file-type">${fileType.name}</span>
                        </div>
                        
                        <div class="quality-assessment" style="display: none;">
                            <div class="quality-metric visual-quality">
                                <div class="metric-label">Visual Quality</div>
                                <div class="metric-value quality-score-value">-</div>
                            </div>
                            <div class="quality-metric compression-ratio">
                                <div class="metric-label">Space Saved</div>
                                <div class="metric-value compression-ratio-value">-</div>
                            </div>
                            <div class="quality-metric file-size">
                                <div class="metric-label">Size Reduction</div>
                                <div class="metric-value size-reduction-value">-</div>
                            </div>
                            <div class="quality-metric efficiency">
                                <div class="metric-label">Efficiency</div>
                                <div class="metric-value efficiency-score-value">-</div>
                            </div>
                        </div>
                        
                        <div class="size-comparison">
                            <div class="size-info original">
                                <strong>Original</strong><br>
                                ${formatFileSize(file.size)}
                            </div>
                            <div class="size-info compressed">
                                <strong>Compressed</strong><br>
                                <span class="compressed-size-value">-</span>
                            </div>
                        </div>
                        <div class="compression-status ready">Ready to compress</div>
                        <div class="compression-progress" style="display: none;">
                            <div class="compression-progress-bar"></div>
                        </div>
                        <button class="download-btn">üì• Download Compressed</button>
                    </div>
                `;
                previewContainer.appendChild(preview);
                
                // Add click event listener for modal opening
                const comparisonContainer = preview.querySelector('.comparison-container');
                comparisonContainer.addEventListener('click', function(e) {
                    // Only open modal if not clicking on slider
                    if (!e.target.classList.contains('comparison-slider') && 
                        !e.target.closest('.comparison-slider-container')) {
                        openComparisonModal(this);
                    }
                });
            };
            
            reader.readAsDataURL(file);
        }

        function updateFullImageComparison(slider) {
            const value = slider.value;
            const container = slider.closest('.comparison-container');
            const compressedImage = container.querySelector('.comparison-image.compressed');
            const dividerLine = container.querySelector('.divider-line');
            
            if (compressedImage && !compressedImage.classList.contains('disabled')) {
                const clipValue = 100 - value;
                compressedImage.style.clipPath = `inset(0 ${clipValue}% 0 0)`;
                dividerLine.style.left = value + '%';
            }
        }

        function openComparisonModal(container) {
            const preview = container.closest('.preview');
            const originalImg = preview.querySelector('.comparison-image.original img');
            const compressedImg = preview.querySelector('.comparison-image.compressed img');
            const fileName = preview.querySelector('.file-name').textContent;
            
            if (originalImg && compressedImg && compressedImg.src && 
                !compressedImg.closest('.comparison-image').classList.contains('disabled')) {
                openModal(originalImg.src, compressedImg.src, fileName);
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function compressImage(file, quality) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    const outputFormat = 'image/jpeg';
                    const fileExtension = file.name.includes('.') ? 
                        file.name.substring(0, file.name.lastIndexOf('.')) + '_compressed.jpg' :
                        file.name + '_compressed.jpg';
                    
                    canvas.toBlob((blob) => {
                        if (blob) {
                            const dataUrl = canvas.toDataURL(outputFormat, quality / 100);
                            
                            const visualQuality = calculateVisualQuality(file.size, blob.size, quality);
                            const compressionRatio = calculateCompressionRatio(file.size, blob.size);
                            const efficiency = calculateEfficiencyScore(compressionRatio, visualQuality);
                            
                            resolve({
                                blob: blob,
                                name: fileExtension,
                                originalSize: file.size,
                                compressedSize: blob.size,
                                originalType: file.type,
                                dataUrl: dataUrl,
                                metrics: {
                                    visualQuality: visualQuality,
                                    compressionRatio: compressionRatio,
                                    efficiency: efficiency,
                                    qualityGrade: getQualityGrade(visualQuality)
                                }
                            });
                        } else {
                            reject(new Error('Failed to compress image'));
                        }
                    }, outputFormat, quality / 100);
                };
                
                img.onerror = () => reject(new Error('Failed to load image'));
                
                const reader = new FileReader();
                reader.onload = (e) => img.src = e.target.result;
                reader.onerror = () => reject(new Error('Failed to read file'));
                reader.readAsDataURL(file);
            });
        }

        compressAllBtn.addEventListener('click', async () => {
            if (uploadedFiles.length === 0) {
                alert('Please upload some files first!');
                return;
            }

            compressAllBtn.disabled = true;
            compressAllBtn.textContent = 'üîÑ Compressing...';
            compressedFiles = [];

            const quality = parseInt(qualitySlider.value);
            const previews = document.querySelectorAll('.preview');

            for (let i = 0; i < uploadedFiles.length; i++) {
                const file = uploadedFiles[i];
                const preview = previews[i];
                
                const status = preview.querySelector('.compression-status');
                const progressBar = preview.querySelector('.compression-progress');
                const progressBarFill = preview.querySelector('.compression-progress-bar');
                const compressedImageDiv = preview.querySelector('.comparison-image.compressed');
                const qualityAssessment = preview.querySelector('.quality-assessment');
                const comparisonSlider = preview.querySelector('.comparison-slider');
                const sliderOverlay = preview.querySelector('.comparison-slider-overlay');
                const comparisonContainer = preview.querySelector('.comparison-container');
                
                try {
                    status.textContent = 'Compressing...';
                    status.className = 'compression-status compressing';
                    progressBar.style.display = 'block';
                    progressBarFill.style.width = '50%';

                    const compressedData = await compressImage(file, quality);
                    compressedFiles.push(compressedData);

                    const compressedSizeSpan = preview.querySelector('.compressed-size-value');
                    const downloadBtn = preview.querySelector('.download-btn');
                    
                    progressBarFill.style.width = '100%';
                    
                    setTimeout(() => {
                        const savings = compressedData.metrics.compressionRatio;
                        const qualityGrade = compressedData.metrics.qualityGrade;
                        
                        // Update compressed image and enable slider
                        compressedImageDiv.innerHTML = `
                            <img src="${compressedData.dataUrl}" alt="Compressed ${file.name}" data-compressed-src="${compressedData.dataUrl}">
                            <div class="quality-score quality-${qualityGrade.class}-score">${qualityGrade.grade}</div>
                            <div class="savings-badge">-${savings}%</div>
                        `;
                        
                        // Remove disabled state and enable features
                        compressedImageDiv.classList.remove('disabled');
                        comparisonSlider.disabled = false;
                        sliderOverlay.classList.add('active');
                        comparisonContainer.classList.add('clickable');
                        
                        // Initialize comparison at 50%
                        updateFullImageComparison(comparisonSlider);
                        
                        qualityAssessment.style.display = 'grid';
                        preview.querySelector('.quality-score-value').textContent = 
                            `${compressedData.metrics.visualQuality}% (${qualityGrade.grade})`;
                        preview.querySelector('.compression-ratio-value').textContent = 
                            `${compressedData.metrics.compressionRatio}%`;
                        preview.querySelector('.size-reduction-value').textContent = 
                            formatFileSize(file.size - compressedData.compressedSize);
                        preview.querySelector('.efficiency-score-value').textContent = 
                            `${compressedData.metrics.efficiency}%`;
                        
                        compressedSizeSpan.textContent = formatFileSize(compressedData.compressedSize);
                        status.textContent = `Compression Complete! (${qualityGrade.description})`;
                        status.className = 'compression-status completed';
                        
                        progressBar.style.display = 'none';
                        downloadBtn.classList.add('show');
                        
                        downloadBtn.onclick = () => {
                            downloadFile(compressedData);
                            const originalText = downloadBtn.textContent;
                            downloadBtn.textContent = '‚úÖ Downloaded!';
                            downloadBtn.style.background = 'linear-gradient(45deg, #6f42c1, #e83e8c)';
                            setTimeout(() => {
                                downloadBtn.textContent = originalText;
                                downloadBtn.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
                            }, 1500);
                        };
                    }, 500);
                } catch (error) {
                    status.textContent = 'Compression Failed';
                    status.className = 'compression-status error';
                    progressBar.style.display = 'none';
                    console.error('Compression error:', error);
                }
            }

            compressAllBtn.disabled = false;
            compressAllBtn.textContent = 'üöÄ Compress All Files';
            downloadAllBtn.disabled = false;
        });

        downloadAllBtn.addEventListener('click', () => {
            if (compressedFiles.length === 0) {
                alert('Please compress files first!');
                return;
            }

            compressedFiles.forEach((file, index) => {
                setTimeout(() => {
                    downloadFile(file);
                }, index * 200);
            });
        });

        function downloadFile(fileData) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(fileData.blob);
            link.download = fileData.name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
    </script>
</body>
</html>
